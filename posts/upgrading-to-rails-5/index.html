<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><title>Upgrading to Rails 5 - rono23</title><link rel="alternate" type="application/atom+xml" title="rono23 - Atom Feed" href="/posts/feed.xml" /><link href="/stylesheets/all-2db23f73.css" rel="stylesheet" /><script src="/javascripts/all-da39a3ee.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-845284-7', 'auto');
  ga('send', 'pageview');
</script>
</head><body><div class="header clear"><div class="l-constrained"><h1><a href="/">rono23</a></h1><ul><li><a href="/about">About</a></li></ul></div></div><div class="hero" style="background-image: url('/images/hero/mountain-edf4b553.jpg')"></div><div class="main"><div class="l-constrained"><div class="post-date">July  2, 2016</div><div class="post-title">Upgrading to Rails 5</div><div class="markdown"><p>There are lots of changes, so I just picked up some here.</p>

<h2>ActiveRecord</h2>

<p><code>belongs_to</code> required by default.</p>

<pre><code># config/initializers/new_framework_defaults.rb
Rails.application.config.active_record.belongs_to_required_by_default = true

# app/models/post.rb
- belongs_to :user, required: true
+ belongs_to :user
</code></pre>

<p>But you need to care about it because of other gems. It sometimes doesn&#39;t work if one of gems is using a hook like <code>ActiveRecord::Base.extend</code>, <code>ActiveRecord::Base.send :include</code> etc intead of <code>ActiveSupport.on_load(:active_record)</code>.<br>
<a href="https://github.com/rails/rails/issues/23589">#rails/rails#23589</a></p>

<h2>ActionMailer</h2>

<p>Change your mailers to inherit from your new <code>ApplicationMailer</code>.</p>

<pre><code># app/mailers/application_mailer.rb
class ApplicationMailer &lt; ActionMailer::Base
  default from: &#39;noreply@example.com&#39;
  layout &#39;mailer&#39; #=&gt; app/views/layouts/mailer.html.erb or mailer.txt.erb
end
</code></pre>

<h2>Default values in initializers</h2>

<p>Setup the default locale, generators etc from an initializer instead of <code>config/application.rb</code></p>

<pre><code># config/initializers/locale.rb
Rails.application.config.i18n.available_locales = [:en, :ja]
Rails.application.config.i18n.default_locale = :en

# config/initializers/generators.rb
Rails.application.config.generators do |g|
  g.stylesheet_engine :sass
  g.template_engine :slim
  ...
end
</code></pre>

<p>But you shouldn&#39;t assign some values such as <code>time_zone</code> in an initializer. Because <code>Rails.application.config.time_zone</code> will work, but <code>Time.zone</code> won&#39;t. <a href="https://github.com/rails/rails/blob/791bdf6fb350b5cb272e4277c1b2b3d04beb7a35/activesupport/lib/active_support/railtie.rb#L25">Time.zone_default</a> is assgined before the initializer.</p>

<blockquote>
<p>In general, configuration specific to the application object needs to go either in config/application.rb or in config/environments/#{Rails.env}.rb, you can&#39;t just assign to an arbitrary config point in config/initializers and expect it to work.<br>
<a href="https://github.com/rails/rails/issues/24748#issuecomment-216317145">https://github.com/rails/rails/issues/24748#issuecomment-216317145</a></p>
</blockquote>

<pre><code># config/application.rb
module Foo
  class Application &lt; Rails::Application
    config.time_zone = &#39;UTC&#39;
    config.paths.add &#39;lib&#39;, eager_load: true
  end
end
</code></pre>

<h2>Quiet assets</h2>

<p>You don&#39;t need <a href="https://github.com/evrone/quiet_assets">quiet_assets</a> gem finally! Logger output is suppressed using <code>Rails.application.config.assets.prefix</code> path to match.<br>
<a href="https://github.com/rails/rails/pull/25351">rails/rails#25351</a>, <a href="https://github.com/rails/sprockets-rails/pull/355/files">rails/sprockets-rails#355</a></p>

<pre><code># config/environments/development.rb
# Suppress logger output for asset requests.
config.assets.quiet = true
</code></pre>

<h2>Related links</h2>

<ul>
<li><a href="http://guides.rubyonrails.org/5_0_release_notes.html">Ruby on Rails 5.0 Release Notes</a></li>
<li><a href="http://guides.rubyonrails.org/upgrading_ruby_on_rails.html">A Guide for Upgrading Ruby on Rails</a></li>
<li><a href="http://blog.bigbinary.com/categories/Rails-5/">Rails 5 | BigBinary Blog</a></li>
</ul>
</div><div class="post-comment"><p><a href="https://github.com/rono23/rono23.github.io/issues/new?title=[upgrading-to-rails-5]%20">Post a comment on GitHub</a></p></div><div class="post-tags"><ul class="inline"><li>Tags:</li><li><a href="/posts/tags/rails/">rails</a></li></ul></div></div></div><div class="footer"><div class="l-constrained"><div class="copy">&copy; 2020 rono23</div></div></div></body></html>